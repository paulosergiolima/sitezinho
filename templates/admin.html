<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Administrativo - Artebonitinha</title>
    <link rel="icon" type="image/png" href="static/assets/arte.png">
    <link rel="stylesheet" href="static/css/style.css">
    <script src="static/js/main.js"></script>
</head>
<body class="admin-body">
    <!-- Admin Header -->
    <header class="admin-header">
        <div class="admin-header-content">
            <h1>üé® Painel Administrativo</h1>
            <div class="header-buttons">
                <a href="/" class="back-btn">‚Üê Voltar √† Galeria</a>
                <a href="/count" class="back-btn">Ver Resultados</a>
            </div>
        </div>
    </header>

    <div class="admin-container">
        <!-- Upload Section -->
        <section class="admin-section upload-section">
            <div class="section-header">
                <h2>üì§ Upload de Artes</h2>
                <p class="section-description">Gerencie as imagens da galeria</p>
            </div>
            
            <div class="upload-info">
                <h3>Formatos Aceitos:</h3>
                <div class="format-tags">
                    <span class="format-tag">PNG</span>
                    <span class="format-tag">JPG</span>
                    <span class="format-tag">JPEG</span>
                    <span class="format-tag">GIF</span>
                    <span class="format-tag">BMP</span>
                    <span class="format-tag">WEBP</span>
                    <span class="format-tag">TIFF</span>
                    <span class="format-tag zip">ZIP</span>
                </div>
            </div>
            
            <form method="POST" action="/insert" enctype="multipart/form-data" class="upload-form">
                <div class="file-input-container">
                    <label for="file" class="file-input-label">
                        <span class="file-icon">üìÅ</span>
                        <span>Selecionar Arquivos</span>
                        <input type="file" name="file" id="file" multiple accept=".png,.jpg,.jpeg,.gif,.bmp,.webp,.tiff,.zip">
                    </label>
                    <div class="file-info" id="fileInfo"></div>
                </div>
                <button type="submit" class="upload-btn">
                    <span>üì§</span>
                    Enviar Arquivo(s)
                </button>
            </form>
            
            <!-- Upload Feedback -->
            {% if session.upload_success %}
            <div class="alert alert-success">
                <span class="alert-icon">‚úÖ</span>
                <div class="alert-content">
                    <strong>Sucesso!</strong>
                    {{ session.upload_success }}
                </div>
            </div>
            {% endif %}
            
            {% if session.upload_errors %}
            <div class="alert alert-error">
                <span class="alert-icon">‚ùå</span>
                <div class="alert-content">
                    <strong>Erros encontrados:</strong>
                    <ul class="error-list">
                    {% for error in session.upload_errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                    </ul>
                </div>
            </div>
            {% endif %}
        </section>

        <!-- Vote Management Section -->
        <section class="admin-section vote-section">
            <div class="section-header">
                <h2>üó≥Ô∏è Gerenciar Vota√ß√£o</h2>
                <p class="section-description">Controles de vota√ß√£o e estat√≠sticas</p>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number">{{count}}</div>
                    <div class="stat-label">Total de Votos</div>
                </div>
            </div>

            <div class="export-template">
                <button onclick="export_merged_image()" class="control-button export-btn">
                    <span>üé®</span>
                    <div class="button-content">
                        <div class="button-title">Exportar Collage</div>
                        <div class="button-description">Baixar todas as imagens em uma √∫nica collage</div>
                    </div>
                </button>
                
                <!-- Export Options (Always Visible) -->
                <div class="export-options" id="exportOptions">
                    <div class="options-header">
                        <h4>‚öôÔ∏è Op√ß√µes de Exporta√ß√£o</h4>
                    </div>
                    <div class="option-group">
                        <label for="exportGap">Espa√ßamento entre imagens:</label>
                        <input type="range" id="exportGap" min="0" max="10" value="2" />
                        <span class="range-value" id="gapValue">2px</span>
                    </div>
                    <div class="option-group">
                        <label for="exportFormat">Formato:</label>
                        <select id="exportFormat">
                            <option value="png">PNG (Alta qualidade)</option>
                            <option value="jpeg">JPEG (Menor tamanho)</option>
                        </select>
                    </div>
                    <div class="option-group">
                        <label>
                            <input type="checkbox" id="fixedSize" />
                            Tamanho fixo (1600x1600)
                        </label>
                    </div>
                    <div class="fixed-size-options" id="fixedSizeOptions" style="display: none;">
                        <div class="size-inputs">
                            <input type="number" id="exportWidth" placeholder="Largura" value="1600" min="400" max="3000" />
                            <span>x</span>
                            <input type="number" id="exportHeight" placeholder="Altura" value="1600" min="400" max="3000" />
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="vote-controls">
                <button onclick="change_vote_unique()" class="control-button unique">
                    <span>üîò</span>
                    <div class="button-content">
                        <div class="button-title">Escolha √önica</div>
                        <div class="button-description">Permitir apenas um voto por usu√°rio</div>
                    </div>
                </button>
                
                <button onclick="change_vote_multiple()" class="control-button multiple">
                    <span>‚òëÔ∏è</span>
                    <div class="button-content">
                        <div class="button-title">M√∫ltipla Escolha</div>
                        <div class="button-description">Permitir votos em v√°rias artes</div>
                    </div>
                </button>
            </div>
            
            <!-- Percentage Configuration -->
            <div class="percentage-config">
                <div class="config-header">
                    <h3>‚öôÔ∏è Configura√ß√£o de M√∫ltipla Escolha</h3>
                    <p>Defina quantos % das imagens cada usu√°rio pode votar</p>
                </div>
                <div class="percentage-input-group">
                    <label for="votePercentage">Porcentagem m√°xima:</label>
                    <div class="input-with-button">
                        <input type="number" id="votePercentage" min="1" max="100" value="{{ vote_percentage }}" />
                        <span class="percentage-symbol">%</span>
                        <button onclick="setVotePercentage()" class="btn btn-small">Aplicar</button>
                    </div>
                    <div class="percentage-info">
                        <small>Atual: <strong>{{ vote_percentage }}%</strong> (m√°ximo <span id="maxVotesDisplay">{{ (image_count * vote_percentage / 100)|round|int }}</span> votos de {{ image_count }} imagens)</small>
                    </div>
                </div>
            </div>
            
            <div class="vote-controls">
                
                <button onclick="delete_votes()" class="control-button danger">
                    <span>üóëÔ∏è</span>
                    <div class="button-content">
                        <div class="button-title">Limpar Votos</div>
                        <div class="button-description">Apagar todos os votos existentes</div>
                    </div>
                </button>
                
                <button onclick="delete_images()" class="control-button danger">
                    <span>üñºÔ∏è</span>
                    <div class="button-content">
                        <div class="button-title">Remover Imagens</div>
                        <div class="button-description">Apagar todas as imagens da galeria</div>
                    </div>
                </button>
            </div>
        </section>

        <!-- Votes List Section -->
        {% if users %}
        <section class="admin-section votes-section">
            <div class="section-header">
                <h2>üìä Lista de Votos</h2>
                <p class="section-description">Hist√≥rico detalhado de vota√ß√µes</p>
            </div>
            
            <div class="votes-list">
                {% for user in users %}
                <div class="vote-item">
                    <div class="vote-info">
                        <div class="voter-name">üë§ {{user.username}}</div>
                        <div class="vote-time">üïí {{user.created}}</div>
                    </div>
                    <button onclick="delete_vote('{{user.id}}')" class="delete-vote-btn">
                        <span>üóëÔ∏è</span>
                        Deletar
                    </button>
                </div>
                {% endfor %}
            </div>
        </section>
        {% endif %}
    </div>
</body>
</html>