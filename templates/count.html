<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resultados - Artebonitinha</title>    <!-- Favicon - icon that appears in the browser tab -->
    <link rel="icon" type="image/png" href="static/assets/arte.png">
    <link rel="stylesheet" href="static/css/style.css">
    <script src="static/js/main.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dom-to-image-more@3.3.0/dist/dom-to-image-more.min.js"></script>
</head>
<body class="results-body">
    <div id="results-root">
    <!-- Results Header -->
    <header class="results-header">
        <div class="results-header-content">
            <h1>üèÜ Resultados da Vota√ß√£o</h1>

            <div class="back-btn-results-container">
                <a href="/" class="back-btn-results">‚Üê Voltar √† Galeria</a>
                <a href="/votes" class="back-btn-results">Votos</a>
            </div>
        </div>
    </header>

    <div class="artes">
        {% for key, value in images.items() %}
            <div class="option result-card">
                <!-- Result rank indicator -->
                <div class="result-rank">
                    <span class="rank-number">#{{ loop.index }}</span>
                    {% if loop.index == 1 %}
                        <span class="rank-medal">ü•á</span>
                    {% elif loop.index == 2 %}
                        <span class="rank-medal">ü•à</span>
                    {% elif loop.index == 3 %}
                        <span class="rank-medal">ü•â</span>
                    {% endif %}
                </div>
                
                <!-- Image container -->
                <div class="image-container">
                    <img class="img-option" src="static/images/{{key}}" alt="{{key}}">
                </div>
                
                <!-- Vote count display -->
                <div class="vote-count" onclick="toggleVoters('voters-{{loop.index}}')" style="cursor: pointer;" title="Clique para ver quem votou">
                    <div class="vote-number">{{value.count}}</div>
                    <div class="vote-label">
                        {% if value.count == 1 %}
                            voto
                        {% else %}
                            votos
                        {% endif %}
                    </div>
                    <div class="voters-icon">üë•</div>
                </div>
                
                <!-- Voters list (hidden by default) -->
                <div id="voters-{{loop.index}}" class="voters-list" style="display: none;">
                    <div class="voters-header">
                        <strong>Votaram nesta imagem:</strong>
                        <button class="close-voters" onclick="toggleVoters('voters-{{loop.index}}')">&times;</button>
                    </div>
                    <div class="voters-content">
                        {% for voter in value.voters %}
                            <div class="voter-item">
                                <span class="voter-icon">üë§</span>
                                <span class="voter-name">{{voter}}</span>
                            </div>
                        {% endfor %}
                    </div>
                </div>
                
                <!-- Image name -->
                <div class="result-image-name">{{key}}</div>
                
                <!-- Full screen button -->
                <button class="view-fullscreen-btn" onclick="openModal('static/images/{{key}}', '{{key}} - {{value.count}} votos')">
                    <span class="btn-icon"></span>
                    Ver em Tela Cheia
                </button>
            </div>
        {% endfor %}
    </div>

    <!-- Modal for full view image with canvas -->
    <div id="imageModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            
            <!-- Canvas container -->
            <div class="canvas-container">
                <canvas id="imageCanvas" class="image-canvas"></canvas>
            </div>
            
            <!-- Canvas controls -->
            <div class="canvas-controls">
                <button id="zoomOut" class="control-btn" title="Zoom Out">üîç-</button>
                <button id="zoomIn" class="control-btn" title="Zoom In">üîç+</button>
                <button id="resetZoom" class="control-btn" title="Reset View">‚ö°</button>
                <button id="fitToScreen" class="control-btn" title="Fit to Screen">üì±</button>
                <span class="zoom-level">100%</span>
            </div>
            
            <div class="modal-info">
                <h3 id="modalTitle">Arte Bonitinha</h3>
                <p id="modalDescription">Use os controles para navegar ‚Ä¢ Arraste para mover ‚Ä¢ Scroll para zoom</p>
            </div>
        </div>
    </div>
    </div>
    <script>
        // Aguardar 'load' garante que imagens, CSS e fontes estejam prontos
        window.addEventListener('load', function() {
            try {
                const params = new URLSearchParams(window.location.search);
                if (params.get('export') === '1') {
                    // Delay maior para estabilizar layout antes do print
                    setTimeout(() => {
                        if (typeof export_count_screenshot === 'function') {
                            export_count_screenshot();
                            // Aguardar mais tempo para o download iniciar antes de voltar
                            setTimeout(() => { window.location.href = '/admin'; }, 1500);
                        }
                    }, 1000);
                }
            } catch (e) {}
        });
    </script>
</body>
</html>